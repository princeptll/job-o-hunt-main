WaitAll = require('./index').WaitAll;
start = require('./index').start;
sleep = require('./index').sleep;
skip = require('./index').skip;

(function() {
    function* testSleep(duration) {
        yield sleep(duration);
    }

    function* testroutine(message) {
        yield skip("in testroutine");
        console.log("sleep 2000");
        
        waitAll = new WaitAll;
        wait = waitAll.wait;
        all = waitAll.all;
        wait(testSleep(500));
        wait(testSleep(1000));
        wait(testRoutineError(1500));
        wait(testRoutineError(2000));
        
        try {
            yield all;
        }
        catch(exception) {
            console.error("RoutineError: " + exception);
        }
        
        return 100;
    }
    
    function* testRoutineError(duration) {
        yield skip('testRoutineError');
        yield sleep(duration);
        //yield testAsyncError;
        throw "something really bad is happening!";
    }
    
    function testAsyncError(callback) {
        console.log("here");
        callback("something bad has happened!");
    }

    start((function*() {
        console.log("sleep 1000");
        yield sleep(1000);
        value = yield* testroutine();
        console.log("result = " + value);
        
        try {
           yield testAsyncError;
        }
        catch(exception) {
           console.error("AsyncError: " + exception);
        }
        
    })());
})();

